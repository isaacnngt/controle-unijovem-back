<!-- ========================================
     PARÂMETROS - src/main/resources/templates/parametros/formulario.html
     ======================================== -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Parâmetros Financeiros - Sistema UNIJovem</title>
</head>
<body>
<div layout:fragment="content">
    <!-- Header da Página -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-2">
                <i class="fas fa-cog text-primary me-2"></i> Parâmetros Financeiros
            </h2>
            <p class="text-muted mb-0">Configure os valores de mensalidade e camisa do sistema</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-info" onclick="mostrarHistorico()">
                <i class="fas fa-history me-2"></i> Histórico
            </button>
            <button class="btn btn-info" onclick="calcularImpacto()">
                <i class="fas fa-calculator me-2"></i> Calcular Impacto
            </button>
        </div>
    </div>

    <!-- Alert de Sucesso -->
    <div th:if="${param.success}" class="alert alert-success border-0 animate-fade-in"
         style="background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);">
        <div class="d-flex align-items-center">
            <i class="fas fa-check-circle fa-2x text-success me-3"></i>
            <div>
                <h6 class="fw-bold mb-1">Parâmetros Atualizados!</h6>
                <p class="mb-0">Os novos valores foram salvos e aplicados ao sistema.</p>
            </div>
        </div>
    </div>

    <!-- Dashboard de Impacto -->
    <div class="row g-4 mb-4">
        <!-- Receita Mensal Prevista -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 h-100 animate-fade-in" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-coins fa-3x me-3" style="opacity: 0.8;"></i>
                        <div>
                            <h6 class="text-uppercase mb-1">Receita Mensal</h6>
                            <h3 class="fw-bold mb-0" id="receitaMensal">R$ 0,00</h3>
                            <small class="opacity-75">Prevista</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Receita Anual -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 h-100 animate-fade-in animate-delay-1" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-chart-line fa-3x me-3" style="opacity: 0.8;"></i>
                        <div>
                            <h6 class="text-uppercase mb-1">Receita Anual</h6>
                            <h3 class="fw-bold mb-0" id="receitaAnual">R$ 0,00</h3>
                            <small class="opacity-75">Projetada</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Jovens Ativos -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 h-100 animate-fade-in animate-delay-2" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-users fa-3x me-3" style="opacity: 0.8;"></i>
                        <div>
                            <h6 class="text-uppercase mb-1">Jovens Ativos</h6>
                            <h3 class="fw-bold mb-0" id="jovensAtivos">142</h3>
                            <small class="opacity-75">Cadastrados</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Última Atualização -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 h-100 animate-fade-in animate-delay-3" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-clock fa-3x me-3" style="opacity: 0.8;"></i>
                        <div>
                            <h6 class="text-uppercase mb-1">Atualização</h6>
                            <h3 class="fw-bold mb-0" id="ultimaAtualizacao">Hoje</h3>
                            <small class="opacity-75">Parâmetros</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulário Principal -->
    <div class="row g-4">
        <!-- Configuração de Valores -->
        <div class="col-lg-8">
            <div class="card animate-fade-in animate-delay-1">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h5 class="fw-bold mb-0">
                        <i class="fas fa-dollar-sign me-2"></i>
                        Configuração de Valores
                    </h5>
                </div>
                <div class="card-body p-4">
                    <form th:action="@{/parametros}" th:object="${parametros}" method="POST" id="formParametros">

                        <!-- Valor da Mensalidade -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <label for="valorMensalidade" class="form-label fw-bold mb-3">
                                    <i class="fas fa-calendar-check text-primary me-2"></i>
                                    Valor da Mensalidade
                                </label>
                                <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-primary text-white">
                                            <i class="fas fa-dollar-sign"></i>
                                        </span>
                                    <input type="number"
                                           class="form-control form-control-lg"
                                           id="valorMensalidade"
                                           th:field="*{valorMensalidade}"
                                           step="0.01"
                                           min="0"
                                           placeholder="0,00"
                                           required>
                                    <span class="input-group-text bg-light">
                                            <i class="fas fa-calendar-alt text-muted"></i> / mês
                                        </span>
                                </div>
                                <div class="form-text mt-2">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Valor cobrado mensalmente de cada jovem
                                </div>

                                <!-- Preview da Mensalidade -->
                                <div class="mt-3 p-3 bg-light rounded" id="previewMensalidade">
                                    <div class="row text-center">
                                        <div class="col-md-4">
                                            <small class="text-muted">Por Jovem/Mês</small>
                                            <h6 class="fw-bold text-primary mb-0" id="valorPorJovem">R$ 0,00</h6>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">Total Mensal</small>
                                            <h6 class="fw-bold text-success mb-0" id="totalMensal">R$ 0,00</h6>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">Total Anual</small>
                                            <h6 class="fw-bold text-info mb-0" id="totalAnual">R$ 0,00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Valor da Camisa -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <label for="valorCamisa" class="form-label fw-bold mb-3">
                                    <i class="fas fa-tshirt text-primary me-2"></i>
                                    Valor da Camisa
                                </label>
                                <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-success text-white">
                                            <i class="fas fa-tshirt"></i>
                                        </span>
                                    <input type="number"
                                           class="form-control form-control-lg"
                                           id="valorCamisa"
                                           th:field="*{valorCamisa}"
                                           step="0.01"
                                           min="0"
                                           placeholder="0,00"
                                           required>
                                    <span class="input-group-text bg-light">
                                            <i class="fas fa-tag text-muted"></i> unitário
                                        </span>
                                </div>
                                <div class="form-text mt-2">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Valor unitário da camisa oficial da UNIJovem
                                </div>

                                <!-- Preview da Camisa -->
                                <div class="mt-3 p-3 bg-light rounded" id="previewCamisa">
                                    <div class="row text-center">
                                        <div class="col-md-4">
                                            <small class="text-muted">Valor Unitário</small>
                                            <h6 class="fw-bold text-success mb-0" id="valorUnitario">R$ 0,00</h6>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">Receita Total</small>
                                            <h6 class="fw-bold text-primary mb-0" id="receitaCamisa">R$ 0,00</h6>
                                        </div>
                                        <div class="col-md-4">
                                            <small class="text-muted">Por Jovem</small>
                                            <h6 class="fw-bold text-info mb-0" id="custoPorJovem">R$ 0,00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Botões de Ação -->
                        <div class="row">
                            <div class="col-12">
                                <div class="d-flex justify-content-end gap-3 pt-3 border-top">
                                    <button type="button" class="btn btn-outline-secondary btn-lg" onclick="resetarValores()">
                                        <i class="fas fa-undo me-2"></i> Resetar
                                    </button>
                                    <button type="button" class="btn btn-warning btn-lg" onclick="previewAlteracoes()">
                                        <i class="fas fa-eye me-2"></i> Visualizar Impacto
                                    </button>
                                    <button type="submit" class="btn btn-primary btn-lg" id="btnSalvar">
                                        <i class="fas fa-save me-2"></i> Salvar Parâmetros
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Painel de Informações -->
        <div class="col-lg-4">
            <!-- Dicas e Sugestões -->
            <div class="card mb-4 animate-fade-in animate-delay-2">
                <div class="card-header bg-info text-white">
                    <h6 class="fw-bold mb-0">
                        <i class="fas fa-lightbulb me-2"></i>
                        Dicas e Sugestões
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-start mb-3">
                        <i class="fas fa-check-circle text-success me-3 mt-1"></i>
                        <div>
                            <h6 class="fw-bold mb-1">Valor Adequado</h6>
                            <small class="text-muted">Mensalidade entre R$ 30,00 e R$ 80,00</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-start mb-3">
                        <i class="fas fa-users text-primary me-3 mt-1"></i>
                        <div>
                            <h6 class="fw-bold mb-1">Considere a Realidade</h6>
                            <small class="text-muted">Analise a capacidade financeira dos jovens</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-start">
                        <i class="fas fa-chart-line text-warning me-3 mt-1"></i>
                        <div>
                            <h6 class="fw-bold mb-1">Atualize Regularmente</h6>
                            <small class="text-muted">Revise os valores semestralmente</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparativo de Valores -->
            <div class="card mb-4 animate-fade-in animate-delay-3">
                <div class="card-header bg-warning text-dark">
                    <h6 class="fw-bold mb-0">
                        <i class="fas fa-balance-scale me-2"></i>
                        Comparativo Sugerido
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-bold">Mensalidade Mínima</span>
                            <span class="badge bg-success">R$ 30,00</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: 30%"></div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-bold">Mensalidade Ideal</span>
                            <span class="badge bg-primary">R$ 50,00</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: 50%"></div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-bold">Mensalidade Máxima</span>
                            <span class="badge bg-warning">R$ 80,00</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-warning" style="width: 80%"></div>
                        </div>
                    </div>

                    <hr>

                    <div class="text-center">
                        <h6 class="fw-bold text-muted">Valor Atual</h6>
                        <h4 class="fw-bold text-primary" id="valorAtualDisplay">R$ 0,00</h4>
                        <div class="progress" style="height: 12px;">
                            <div class="progress-bar bg-primary" id="progressAtual" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calculadora Rápida -->
            <div class="card animate-fade-in animate-delay-4">
                <div class="card-header bg-secondary text-white">
                    <h6 class="fw-bold mb-0">
                        <i class="fas fa-calculator me-2"></i>
                        Calculadora Rápida
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Meta de Arrecadação Mensal</label>
                        <div class="input-group">
                            <span class="input-group-text">R$</span>
                            <input type="number" class="form-control" id="metaArrecadacao" placeholder="0,00">
                        </div>
                    </div>

                    <button class="btn btn-secondary w-100" onclick="calcularValorSugerido()">
                        <i class="fas fa-magic me-2"></i>
                        Calcular Valor Sugerido
                    </button>

                    <div class="mt-3 p-3 bg-light rounded text-center" id="resultadoCalculo" style="display: none;">
                        <h6 class="fw-bold">Valor Sugerido</h6>
                        <h4 class="text-primary" id="valorSugerido">R$ 0,00</h4>
                        <small class="text-muted">por jovem/mês</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Impacto -->
    <div class="modal fade" id="modalImpacto" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                        <i class="fas fa-chart-bar me-2"></i>
                        Análise de Impacto das Alterações
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <h6 class="fw-bold text-primary">Valores Atuais</h6>
                            <div class="bg-light p-3 rounded">
                                <p class="mb-1"><strong>Mensalidade:</strong> <span id="mensalidadeAtual">R$ 0,00</span></p>
                                <p class="mb-1"><strong>Camisa:</strong> <span id="camisaAtual">R$ 0,00</span></p>
                                <p class="mb-0"><strong>Receita Mensal:</strong> <span id="receitaAtual">R$ 0,00</span></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-success">Novos Valores</h6>
                            <div class="bg-light p-3 rounded">
                                <p class="mb-1"><strong>Mensalidade:</strong> <span id="mensalidadeNova">R$ 0,00</span></p>
                                <p class="mb-1"><strong>Camisa:</strong> <span id="camisaNova">R$ 0,00</span></p>
                                <p class="mb-0"><strong>Receita Mensal:</strong> <span id="receitaNova">R$ 0,00</span></p>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12">
                            <h6 class="fw-bold">Impacto Financeiro</h6>
                            <div class="alert alert-info">
                                <div class="row text-center">
                                    <div class="col-md-4">
                                        <h5 class="fw-bold" id="diferencaMensal">+R$ 0,00</h5>
                                        <small>Diferença Mensal</small>
                                    </div>
                                    <div class="col-md-4">
                                        <h5 class="fw-bold" id="diferencaAnual">+R$ 0,00</h5>
                                        <small>Diferença Anual</small>
                                    </div>
                                    <div class="col-md-4">
                                        <h5 class="fw-bold" id="percentualAumento">+0%</h5>
                                        <small>Aumento Percentual</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Fechar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="aplicarAlteracoes()">
                        <i class="fas fa-check me-2"></i>Aplicar Alterações
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .input-group-lg .form-control {
        font-size: 1.2rem;
        padding: 1rem 1.5rem;
    }

    .input-group-lg .input-group-text {
        font-size: 1.2rem;
        padding: 1rem 1.5rem;
    }

    .progress {
        border-radius: 10px;
    }

    .progress-bar {
        border-radius: 10px;
    }

    .card {
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
    }

    .animate-fade-in {
        opacity: 0;
        animation: fadeInUp 0.8s ease-out forwards;
    }

    .animate-delay-1 { animation-delay: 0.2s; }
    .animate-delay-2 { animation-delay: 0.4s; }
    .animate-delay-3 { animation-delay: 0.6s; }
    .animate-delay-4 { animation-delay: 0.8s; }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .btn-lg {
        padding: 0.75rem 2rem;
        font-size: 1.1rem;
    }
</style>

<script>
    const TOTAL_JOVENS = 142;
    let valoresOriginais = {
        mensalidade: 0,
        camisa: 0
    };

    // Atualizar previews em tempo real
    function atualizarPreviews() {
        const valorMensalidade = parseFloat(document.getElementById('valorMensalidade').value) || 0;
        const valorCamisa = parseFloat(document.getElementById('valorCamisa').value) || 0;

        // Preview Mensalidade
        document.getElementById('valorPorJovem').textContent = 'R$ ' + valorMensalidade.toFixed(2).replace('.', ',');
        document.getElementById('totalMensal').textContent = 'R$ ' + (valorMensalidade * TOTAL_JOVENS).toFixed(2).replace('.', ',');
        document.getElementById('totalAnual').textContent = 'R$ ' + (valorMensalidade * TOTAL_JOVENS * 12).toFixed(2).replace('.', ',');

        // Preview Camisa
        document.getElementById('valorUnitario').textContent = 'R$ ' + valorCamisa.toFixed(2).replace('.', ',');
        document.getElementById('receitaCamisa').textContent = 'R$ ' + (valorCamisa * TOTAL_JOVENS).toFixed(2).replace('.', ',');
        document.getElementById('custoPorJovem').textContent = 'R$ ' + valorCamisa.toFixed(2).replace('.', ',');

        // Dashboard
        document.getElementById('receitaMensal').textContent = 'R$ ' + (valorMensalidade * TOTAL_JOVENS).toFixed(2).replace('.', ',');
        document.getElementById('receitaAnual').textContent = 'R$ ' + (valorMensalidade * TOTAL_JOVENS * 12).toFixed(2).replace('.', ',');

        // Valor atual display
        document.getElementById('valorAtualDisplay').textContent = 'R$ ' + valorMensalidade.toFixed(2).replace('.', ',');

        // Progress bar
        const percentual = Math.min((valorMensalidade / 80) * 100, 100);
        document.getElementById('progressAtual').style.width = percentual + '%';
    }

    // Calcular valor sugerido
    function calcularValorSugerido() {
        const meta = parseFloat(document.getElementById('metaArrecadacao').value) || 0;
        const valorSugerido = meta / TOTAL_JOVENS;

        document.getElementById('valorSugerido').textContent = 'R$ ' + valorSugerido.toFixed(2).replace('.', ',');
        document.getElementById('resultadoCalculo').style.display = 'block';

        // Aplicar valor sugerido
        document.getElementById('valorMensalidade').value = valorSugerido.toFixed(2);
        atualizarPreviews();
    }

    // Preview de alterações
    function previewAlteracoes() {
        const mensalidadeNova = parseFloat(document.getElementById('valorMensalidade').value) || 0;
        const camisaNova = parseFloat(document.getElementById('valorCamisa').value) || 0;

        // Preencher modal
        document.getElementById('mensalidadeAtual').textContent = 'R$ ' + valoresOriginais.mensalidade.toFixed(2).replace('.', ',');
        document.getElementById('camisaAtual').textContent = 'R$ ' + valoresOriginais.camisa.toFixed(2).replace('.', ',');
        document.getElementById('receitaAtual').textContent = 'R$ ' + (valoresOriginais.mensalidade * TOTAL_JOVENS).toFixed(2).replace('.', ',');

        document.getElementById('mensalidadeNova').textContent = 'R$ ' + mensalidadeNova.toFixed(2).replace('.', ',');
        document.getElementById('camisaNova').textContent = 'R$ ' + camisaNova.toFixed(2).replace('.', ',');
        document.getElementById('receitaNova').textContent = 'R$ ' + (mensalidadeNova * TOTAL_JOVENS).toFixed(2).replace('.', ',');

        // Calcular diferenças
        const diferencaMensal = (mensalidadeNova - valoresOriginais.mensalidade) * TOTAL_JOVENS;
        const diferencaAnual = diferencaMensal * 12;
        const percentualAumento = valoresOriginais.mensalidade > 0 ?
            ((mensalidadeNova - valoresOriginais.mensalidade) / valoresOriginais.mensalidade * 100) : 0;

        document.getElementById('diferencaMensal').textContent =
            (diferencaMensal >= 0 ? '+' : '') + 'R$ ' + diferencaMensal.toFixed(2).replace('.', ',');
        document.getElementById('diferencaAnual').textContent =
            (diferencaAnual >= 0 ? '+' : '') + 'R$ ' + diferencaAnual.toFixed(2).replace('.', ',');
        document.getElementById('percentualAumento').textContent =
            (percentualAumento >= 0 ? '+' : '') + percentualAumento.toFixed(1) + '%';

        new bootstrap.Modal(document.getElementById('modalImpacto')).show();
    }

    // Aplicar alterações
    function aplicarAlteracoes() {
        document.getElementById('formParametros').submit();
    }

    // Resetar valores
    function resetarValores() {
        document.getElementById('valorMensalidade').value = valoresOriginais.mensalidade.toFixed(2);
        document.getElementById('valorCamisa').value = valoresOriginais.camisa.toFixed(2);
        atualizarPreviews();
    }

    // Mostrar histórico
    function mostrarHistorico() {
        alert('Funcionalidade de histórico será implementada');
    }

    // Calcular impacto
    function calcularImpacto() {
        previewAlteracoes();
    }

    // Submissão do formulário
    function submeterFormulario(event) {
        event.preventDefault();

        const btnSalvar = document.getElementById('btnSalvar');
        btnSalvar.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Salvando...';
        btnSalvar.disabled = true;

        // Simular delay
        setTimeout(() => {
            document.getElementById('formParametros').submit();
        }, 1000);
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        // Capturar valores originais
        valoresOriginais.mensalidade = parseFloat(document.getElementById('valorMensalidade').value) || 50.00;
        valoresOriginais.camisa = parseFloat(document.getElementById('valorCamisa').value) || 35.00;

        // Event listeners
        document.getElementById('valorMensalidade').addEventListener('input', atualizarPreviews);
        document.getElementById('valorCamisa').addEventListener('input', atualizarPreviews);
        document.getElementById('formParametros').addEventListener('submit', submeterFormulario);

        // Atualizar previews inicial
        atualizarPreviews();

        // Foco no primeiro campo
        document.getElementById('valorMensalidade').focus();
    });
</script>
</body>
</html>