<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title th:text="${usuario.id != null ? 'Editar Jovem' : 'Cadastrar Jovem'} + ' - Sistema UNIJovem'"></title>
</head>
<body>
<div layout:fragment="content">
    <!-- Header da Página -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-2">
                <i th:class="${usuario.id != null ? 'fas fa-edit text-warning' : 'fas fa-user-plus text-success'}" class="me-2"></i>
                <span th:text="${usuario.id != null ? 'Editar Jovem' : 'Cadastrar Novo Jovem'}"></span>
            </h2>
            <p class="text-muted mb-0">
                <span th:if="${usuario.id != null}">Atualize as informações do jovem</span>
                <span th:unless="${usuario.id != null}">Preencha os dados para cadastrar um novo jovem</span>
            </p>
        </div>
        <a th:href="@{/usuarios}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i> Voltar à Lista
        </a>
    </div>

    <!-- Progress Bar -->
    <div class="card mb-4 animate-fade-in">
        <div class="card-body py-3">
            <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 0%" id="progressBar"></div>
                    </div>
                </div>
                <div class="ms-3">
                    <span class="badge bg-primary" id="progressText">0% completo</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulário -->
    <div class="card animate-fade-in animate-delay-1">
        <div class="card-body p-4">
            <form th:action="${usuario.id != null ? '/usuarios/' + usuario.id : '/usuarios'}"
                  th:object="${usuario}" method="POST" id="formUsuario">

                <!-- Seção: Informações Pessoais -->
                <div class="row mb-5">
                    <div class="col-12">
                        <h4 class="fw-bold text-primary mb-4">
                            <i class="fas fa-user me-2"></i>
                            Informações Pessoais
                        </h4>
                    </div>

                    <div class="col-md-6 mb-4">
                        <label for="nome" class="form-label fw-bold">
                            <i class="fas fa-signature text-primary me-2"></i>
                            Nome Completo *
                        </label>
                        <input type="text"
                               class="form-control form-control-lg"
                               id="nome"
                               th:field="*{nome}"
                               required
                               placeholder="Digite o nome completo do jovem">
                        <div class="invalid-feedback" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></div>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Campo obrigatório
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <label for="sexo" class="form-label fw-bold">
                            <i class="fas fa-venus-mars text-primary me-2"></i>
                            Sexo
                        </label>
                        <select class="form-select form-select-lg" id="sexo" th:field="*{sexo}">
                            <option value="">Selecione o sexo...</option>
                            <option value="M">
                                <i class="fas fa-mars"></i> Masculino
                            </option>
                            <option value="F">
                                <i class="fas fa-venus"></i> Feminino
                            </option>
                        </select>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Informação opcional
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <label for="dataNascimento" class="form-label fw-bold">
                            <i class="fas fa-birthday-cake text-primary me-2"></i>
                            Data de Nascimento
                        </label>
                        <input type="date"
                               class="form-control form-control-lg"
                               id="dataNascimento"
                               th:field="*{dataNascimento}">
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Idade será calculada automaticamente
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <label for="responsavelDireto" class="form-label fw-bold">
                            <i class="fas fa-user-tie text-primary me-2"></i>
                            Responsável Direto
                        </label>
                        <input type="text"
                               class="form-control form-control-lg"
                               id="responsavelDireto"
                               th:field="*{responsavelDireto}"
                               placeholder="Ex: Pastor João, Presbítero Carlos">
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Líder responsável pelo acompanhamento
                        </div>
                    </div>
                </div>

                <!-- Seção: Cargos e Funções -->
                <div class="row mb-5">
                    <div class="col-12">
                        <h4 class="fw-bold text-primary mb-4">
                            <i class="fas fa-star me-2"></i>
                            Cargos e Funções
                        </h4>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card bg-light border-0">
                            <div class="card-body">
                                <div class="form-check form-switch">
                                    <input class="form-check-input"
                                           type="checkbox"
                                           id="cargoMinisterial"
                                           th:field="*{cargoMinisterial}"
                                           style="font-size: 1.2rem;">
                                    <label class="form-check-label fw-bold" for="cargoMinisterial">
                                        <i class="fas fa-crown text-warning me-2"></i>
                                        Possui Cargo Ministerial
                                    </label>
                                </div>
                                <div class="form-text mt-2">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Marque se o jovem possui algum cargo ministerial na igreja
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <label for="cargoUnijovem" class="form-label fw-bold">
                            <i class="fas fa-users text-primary me-2"></i>
                            Cargo na UNIJovem
                        </label>
                        <select class="form-select form-select-lg" id="cargoUnijovem" th:field="*{cargoUnijovem}">
                            <option value="">Membro (sem cargo específico)</option>
                            <option value="Presidente">
                                <i class="fas fa-user-tie"></i> Presidente
                            </option>
                            <option value="Vice-Presidente">
                                <i class="fas fa-user-friends"></i> Vice-Presidente
                            </option>
                            <option value="Secretário">
                                <i class="fas fa-clipboard"></i> Secretário
                            </option>
                            <option value="Tesoureiro">
                                <i class="fas fa-coins"></i> Tesoureiro
                            </option>
                            <option value="Coordenador de Louvor">
                                <i class="fas fa-music"></i> Coordenador de Louvor
                            </option>
                            <option value="Coordenador de Ensino">
                                <i class="fas fa-chalkboard-teacher"></i> Coordenador de Ensino
                            </option>
                            <option value="Coordenador de Evangelismo">
                                <i class="fas fa-heart"></i> Coordenador de Evangelismo
                            </option>
                        </select>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Cargo específico dentro da UNIJovem
                        </div>
                    </div>
                </div>

                <!-- Preview Card -->
                <div class="row mb-4" id="previewCard" style="display: none;">
                    <div class="col-12">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h5 class="fw-bold mb-3">
                                    <i class="fas fa-eye me-2"></i>
                                    Pré-visualização
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p class="mb-2"><strong>Nome:</strong> <span id="previewNome">-</span></p>
                                        <p class="mb-2"><strong>Sexo:</strong> <span id="previewSexo">-</span></p>
                                        <p class="mb-2"><strong>Responsável:</strong> <span id="previewResponsavel">-</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="mb-2"><strong>Data Nascimento:</strong> <span id="previewData">-</span></p>
                                        <p class="mb-2"><strong>Cargo Ministerial:</strong> <span id="previewMinisterial">-</span></p>
                                        <p class="mb-2"><strong>Cargo UNIJovem:</strong> <span id="previewUnijovem">-</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-end gap-3">
                            <a th:href="@{/usuarios}" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-times me-2"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg" id="btnSalvar">
                                <i class="fas fa-save me-2"></i>
                                <span th:text="${usuario.id != null ? 'Atualizar Jovem' : 'Cadastrar Jovem'}"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .form-control-lg, .form-select-lg {
        padding: 1rem 1.5rem;
        font-size: 1.1rem;
        border-radius: 15px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

    .form-control-lg:focus, .form-select-lg:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        transform: translateY(-2px);
    }

    .form-check-input:checked {
        background-color: #667eea;
        border-color: #667eea;
    }

    .form-check-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    .card {
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
    }

    .progress {
        border-radius: 10px;
        background-color: rgba(102, 126, 234, 0.1);
    }

    .progress-bar {
        border-radius: 10px;
        transition: width 0.3s ease;
    }

    .animate-fade-in {
        opacity: 0;
        animation: fadeInUp 0.8s ease-out forwards;
    }

    .animate-delay-1 { animation-delay: 0.3s; }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .btn-lg {
        padding: 0.75rem 2rem;
        font-size: 1.1rem;
    }

    .form-text {
        font-size: 0.875rem;
        color: #6c757d;
    }

    #previewCard {
        animation: slideDown 0.5s ease-out;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<script>
    // Atualizar barra de progresso
    function atualizarProgresso() {
        const campos = ['nome', 'sexo', 'dataNascimento', 'responsavelDireto', 'cargoUnijovem'];
        const cargoMinisterial = document.getElementById('cargoMinisterial').checked;

        let preenchidos = 0;
        let total = campos.length + 1; // +1 para o checkbox

        campos.forEach(campo => {
            const elemento = document.getElementById(campo);
            if (elemento && elemento.value.trim() !== '') {
                preenchidos++;
            }
        });

        if (cargoMinisterial) {
            preenchidos++;
        }

        const porcentagem = Math.round((preenchidos / total) * 100);
        document.getElementById('progressBar').style.width = porcentagem + '%';
        document.getElementById('progressText').textContent = porcentagem + '% completo';

        // Mostrar preview quando tiver mais de 50%
        if (porcentagem > 50) {
            document.getElementById('previewCard').style.display = 'block';
            atualizarPreview();
        } else {
            document.getElementById('previewCard').style.display = 'none';
        }
    }

    // Atualizar preview
    function atualizarPreview() {
        const nome = document.getElementById('nome').value || 'Não informado';
        const sexo = document.getElementById('sexo').value;
        const responsavel = document.getElementById('responsavelDireto').value || 'Não informado';
        const dataNascimento = document.getElementById('dataNascimento').value || 'Não informado';
        const cargoMinisterial = document.getElementById('cargoMinisterial').checked;
        const cargoUnijovem = document.getElementById('cargoUnijovem').value || 'Membro';

        document.getElementById('previewNome').textContent = nome;
        document.getElementById('previewSexo').textContent = sexo === 'M' ? 'Masculino' : sexo === 'F' ? 'Feminino' : 'Não informado';
        document.getElementById('previewResponsavel').textContent = responsavel;
        document.getElementById('previewData').textContent = dataNascimento !== 'Não informado' ?
            new Date(dataNascimento).toLocaleDateString('pt-BR') : 'Não informado';
        document.getElementById('previewMinisterial').textContent = cargoMinisterial ? 'Sim' : 'Não';
        document.getElementById('previewUnijovem').textContent = cargoUnijovem;
    }

    // Validação em tempo real
    function validarCampo(campo) {
        const elemento = document.getElementById(campo);
        if (elemento.hasAttribute('required') && elemento.value.trim() === '') {
            elemento.classList.add('is-invalid');
            return false;
        } else {
            elemento.classList.remove('is-invalid');
            elemento.classList.add('is-valid');
            return true;
        }
    }

    // Submissão do formulário
    function submeterFormulario(event) {
        event.preventDefault();

        // Validar campos obrigatórios
        const nome = document.getElementById('nome');
        if (!validarCampo('nome')) {
            nome.focus();
            return;
        }

        // Animação no botão
        const btnSalvar = document.getElementById('btnSalvar');
        btnSalvar.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Salvando...';
        btnSalvar.disabled = true;

        // Simular delay e então submeter
        setTimeout(() => {
            document.getElementById('formUsuario').submit();
        }, 1000);
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('formUsuario');
        const campos = ['nome', 'sexo', 'dataNascimento', 'responsavelDireto', 'cargoUnijovem', 'cargoMinisterial'];

        // Event listeners para todos os campos
        campos.forEach(campo => {
            const elemento = document.getElementById(campo);
            if (elemento) {
                elemento.addEventListener('input', atualizarProgresso);
                elemento.addEventListener('change', atualizarProgresso);
            }
        });

        // Event listener para submissão
        form.addEventListener('submit', submeterFormulario);

        // Atualizar progresso inicial
        atualizarProgresso();

        // Foco no primeiro campo
        document.getElementById('nome').focus();
    });
</script>
</body>
</html>