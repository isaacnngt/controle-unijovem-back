<!-- ========================================
     BUSCA DE USUÁRIOS - src/main/resources/templates/usuario/busca.html
     ======================================== -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Buscar Jovens - Sistema UNIJovem</title>
</head>
<body>
<div layout:fragment="content">
    <!-- Header da Página -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-2">
                <i class="fas fa-search text-primary me-2"></i> Buscar Jovens
            </h2>
            <p class="text-muted mb-0">Encontre jovens por nome, cargo ou características específicas</p>
        </div>
        <div class="d-flex gap-2">
            <a th:href="@{/usuarios}" class="btn btn-outline-secondary">
                <i class="fas fa-list me-2"></i> Ver Todos
            </a>
            <a th:href="@{/usuarios/novo}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i> Novo Jovem
            </a>
        </div>
    </div>

    <!-- Card de Busca Avançada -->
    <div class="card mb-4 animate-fade-in">
        <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h5 class="fw-bold mb-0">
                <i class="fas fa-search-plus me-2"></i>
                Busca Avançada
            </h5>
        </div>
        <div class="card-body p-4">
            <form th:action="@{/usuarios/buscar}" method="get" id="formBusca">
                <div class="row g-4">
                    <!-- Campo principal de busca -->
                    <div class="col-md-6">
                        <label for="nome" class="form-label fw-bold">
                            <i class="fas fa-user text-primary me-2"></i>
                            Nome do Jovem
                        </label>
                        <div class="input-group input-group-lg">
                                <span class="input-group-text bg-light">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                            <input type="text"
                                   class="form-control"
                                   id="nome"
                                   name="nome"
                                   th:value="${nomeBusca}"
                                   placeholder="Digite o nome para buscar..."
                                   autocomplete="off">
                            <button type="button" class="btn btn-outline-secondary" id="limparBusca" title="Limpar busca">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            A busca é realizada em tempo real conforme você digita
                        </div>
                    </div>

                    <!-- Filtros avançados -->
                    <div class="col-md-6">
                        <label class="form-label fw-bold">
                            <i class="fas fa-filter text-primary me-2"></i>
                            Filtros Rápidos
                        </label>
                        <div class="d-grid gap-2">
                            <button type="button" class="btn btn-outline-success btn-sm filtro-rapido" data-filtro="emDia">
                                <i class="fas fa-check-circle me-2"></i> Jovens em Dia
                            </button>
                            <button type="button" class="btn btn-outline-warning btn-sm filtro-rapido" data-filtro="comCargos">
                                <i class="fas fa-star me-2"></i> Com Cargos
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-sm filtro-rapido" data-filtro="comDividas">
                                <i class="fas fa-exclamation-triangle me-2"></i> Com Dívidas
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Estatísticas de busca -->
                <div class="row mt-4" id="estatisticasBusca" style="display: none;">
                    <div class="col-12">
                        <div class="alert alert-info border-0" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-chart-bar fa-2x text-info me-3"></i>
                                <div>
                                    <h6 class="fw-bold mb-1">Resultados da Busca</h6>
                                    <p class="mb-0">
                                        <span id="totalResultados">0</span> jovens encontrados
                                        <span id="termoBusca" class="fw-bold"></span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Sugestões de Busca -->
    <div class="card mb-4 animate-fade-in animate-delay-1" id="sugestoesBusca">
        <div class="card-body">
            <h6 class="fw-bold mb-3">
                <i class="fas fa-lightbulb text-warning me-2"></i>
                Sugestões de Busca
            </h6>
            <div class="d-flex flex-wrap gap-2">
                <button type="button" class="btn btn-outline-primary btn-sm sugestao-busca" data-nome="João">
                    <i class="fas fa-search me-1"></i> João
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm sugestao-busca" data-nome="Maria">
                    <i class="fas fa-search me-1"></i> Maria
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm sugestao-busca" data-nome="Pedro">
                    <i class="fas fa-search me-1"></i> Pedro
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm sugestao-busca" data-nome="Ana">
                    <i class="fas fa-search me-1"></i> Ana
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="mostrarTodos()">
                    <i class="fas fa-list me-1"></i> Mostrar Todos
                </button>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="text-center my-4" id="loading" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Buscando...</span>
        </div>
        <p class="text-muted mt-2">Buscando jovens...</p>
    </div>

    <!-- Resultados da Busca -->
    <div class="card animate-fade-in animate-delay-2" id="resultadosBusca" th:if="${usuarios != null}">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="fw-bold mb-0">
                    <i class="fas fa-list-ul text-primary me-2"></i>
                    Resultados da Busca
                    <span th:if="${nomeBusca != null and !nomeBusca.isEmpty()}" class="text-muted">
                            para "<strong th:text="${nomeBusca}" class="text-primary"></strong>"
                        </span>
                </h5>
                <span class="badge bg-primary fs-6" th:text="${usuarios.size()} + ' encontrado(s)'"></span>
            </div>
        </div>
        <div class="card-body p-0">
            <!-- Resultados encontrados -->
            <div th:if="${!usuarios.isEmpty()}">
                <div class="row g-0">
                    <div th:each="usuario, iterStat : ${usuarios}"
                         class="col-lg-6 resultado-item"
                         th:data-status="${usuario.dividas ? 'comDividas' : 'emDia'}"
                         th:data-cargos="${usuario.cargoMinisterial or usuario.cargoUnijovem ? 'comCargos' : 'semCargos'}">
                        <div class="p-4 border-bottom border-end h-100">
                            <div class="d-flex align-items-start">
                                <!-- Avatar -->
                                <div class="avatar-lg me-3">
                                    <div class="avatar-circle"
                                         th:classappend="${usuario.sexo == 'M' ? 'bg-primary' : usuario.sexo == 'F' ? 'bg-danger' : 'bg-secondary'}">
                                        <i th:if="${usuario.sexo == 'M'}" class="fas fa-mars text-white"></i>
                                        <i th:if="${usuario.sexo == 'F'}" class="fas fa-venus text-white"></i>
                                        <i th:if="${usuario.sexo == null}" class="fas fa-user text-white"></i>
                                    </div>
                                </div>

                                <!-- Informações -->
                                <div class="flex-grow-1">
                                    <h5 class="fw-bold mb-2" th:text="${usuario.nome}">Nome do Jovem</h5>

                                    <!-- Detalhes -->
                                    <div class="row g-2 mb-3">
                                        <div class="col-6">
                                            <small class="text-muted d-block">
                                                <i class="fas fa-venus-mars me-1"></i>
                                                <span th:if="${usuario.sexo == 'M'}">Masculino</span>
                                                <span th:if="${usuario.sexo == 'F'}">Feminino</span>
                                                <span th:if="${usuario.sexo == null}">Não informado</span>
                                            </small>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block" th:if="${usuario.dataNascimento != null}">
                                                <i class="fas fa-birthday-cake me-1"></i>
                                                <span th:text="${#temporals.format(usuario.dataNascimento, 'dd/MM/yyyy')}"></span>
                                            </small>
                                        </div>
                                    </div>

                                    <!-- Responsável -->
                                    <p class="text-muted mb-3" th:if="${usuario.responsavelDireto}">
                                        <i class="fas fa-user-tie me-2"></i>
                                        <span th:text="${usuario.responsavelDireto}"></span>
                                    </p>

                                    <!-- Badges -->
                                    <div class="d-flex flex-wrap gap-2 mb-3">
                                            <span th:if="${usuario.cargoMinisterial}" class="badge bg-success-subtle text-success">
                                                <i class="fas fa-crown me-1"></i> Cargo Ministerial
                                            </span>
                                        <span th:if="${usuario.cargoUnijovem}"
                                              class="badge bg-warning-subtle text-warning"
                                              th:text="${usuario.cargoUnijovem}">Cargo UNIJovem</span>
                                        <span th:if="${usuario.dividas}" class="badge bg-danger-subtle text-danger">
                                                <i class="fas fa-exclamation-triangle me-1"></i> Com Dívidas
                                            </span>
                                        <span th:unless="${usuario.dividas}" class="badge bg-success-subtle text-success">
                                                <i class="fas fa-check-circle me-1"></i> Em Dia
                                            </span>
                                    </div>

                                    <!-- Ações -->
                                    <div class="d-flex gap-2">
                                        <a th:href="@{/usuarios/{id}/editar(id=${usuario.id})}"
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit me-1"></i> Editar
                                        </a>
                                        <a th:href="@{/prestacao-contas/usuario/{id}(id=${usuario.id})}"
                                           class="btn btn-sm btn-outline-info">
                                            <i class="fas fa-chart-line me-1"></i> Prestação
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nenhum resultado -->
            <div th:if="${usuarios.isEmpty()}" class="empty-state py-5">
                <i class="fas fa-search-minus"></i>
                <h4 class="fw-bold mt-4">Nenhum jovem encontrado</h4>
                <p class="text-muted mb-4">
                        <span th:if="${nomeBusca != null and !nomeBusca.isEmpty()}">
                            Não encontramos jovens com o nome "<strong th:text="${nomeBusca}"></strong>"
                        </span>
                    <span th:unless="${nomeBusca != null and !nomeBusca.isEmpty()}">
                            Tente usar outros termos de busca
                        </span>
                </p>
                <div class="d-flex gap-2 justify-content-center">
                    <button class="btn btn-outline-primary" onclick="limparBusca()">
                        <i class="fas fa-redo me-2"></i> Nova Busca
                    </button>
                    <a th:href="@{/usuarios}" class="btn btn-primary">
                        <i class="fas fa-list me-2"></i> Ver Todos
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Estado inicial quando não há busca -->
    <div class="card animate-fade-in animate-delay-3" id="estadoInicial" th:if="${usuarios == null}">
        <div class="card-body text-center py-5">
            <div class="mb-4">
                <i class="fas fa-search" style="font-size: 4rem; color: var(--bs-primary); opacity: 0.3;"></i>
            </div>
            <h4 class="fw-bold mb-3">Pronto para Buscar!</h4>
            <p class="text-muted mb-4">
                Digite o nome de um jovem no campo acima para começar a busca.<br>
                Você também pode usar os filtros rápidos ou sugestões.
            </p>
            <div class="d-flex gap-2 justify-content-center">
                <a th:href="@{/usuarios}" class="btn btn-outline-primary">
                    <i class="fas fa-list me-2"></i> Ver Todos os Jovens
                </a>
                <a th:href="@{/usuarios/novo}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i> Cadastrar Novo
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .avatar-lg .avatar-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .resultado-item {
        transition: all 0.3s ease;
    }

    .resultado-item:hover {
        background-color: rgba(102, 126, 234, 0.05);
        transform: scale(1.02);
    }

    .filtro-rapido.active {
        background-color: var(--bs-primary);
        color: white;
        border-color: var(--bs-primary);
    }

    .sugestao-busca:hover {
        background-color: var(--bs-primary);
        color: white;
        border-color: var(--bs-primary);
    }

    .input-group-lg .form-control {
        font-size: 1.1rem;
        padding: 0.75rem 1rem;
    }

    .input-group-lg .input-group-text {
        padding: 0.75rem 1rem;
    }

    .badge {
        font-size: 0.75rem;
        padding: 0.5rem 0.75rem;
    }

    .animate-fade-in {
        opacity: 0;
        animation: fadeInUp 0.8s ease-out forwards;
    }

    .animate-delay-1 { animation-delay: 0.2s; }
    .animate-delay-2 { animation-delay: 0.4s; }
    .animate-delay-3 { animation-delay: 0.6s; }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .spinner-border {
        width: 3rem;
        height: 3rem;
    }
</style>

<script>
    // Busca em tempo real
    let timeoutBusca;
    function buscarTempoReal() {
        clearTimeout(timeoutBusca);
        timeoutBusca = setTimeout(() => {
            const nome = document.getElementById('nome').value.trim();
            if (nome.length >= 2) {
                mostrarLoading();
                document.getElementById('formBusca').submit();
            }
        }, 500);
    }

    // Filtros rápidos
    function aplicarFiltroRapido(filtro) {
        const resultados = document.querySelectorAll('.resultado-item');

        // Remover classe active de todos os botões
        document.querySelectorAll('.filtro-rapido').forEach(btn => {
            btn.classList.remove('active');
        });

        // Adicionar classe active ao botão clicado
        event.target.classList.add('active');

        resultados.forEach(item => {
            let mostrar = true;

            switch(filtro) {
                case 'emDia':
                    mostrar = item.dataset.status === 'emDia';
                    break;
                case 'comDividas':
                    mostrar = item.dataset.status === 'comDividas';
                    break;
                case 'comCargos':
                    mostrar = item.dataset.cargos === 'comCargos';
                    break;
            }

            item.style.display = mostrar ? 'block' : 'none';
        });

        atualizarContadorResultados();
    }

    // Sugestões de busca
    function aplicarSugestao(nome) {
        document.getElementById('nome').value = nome;
        document.getElementById('formBusca').submit();
    }

    // Limpar busca
    function limparBusca() {
        document.getElementById('nome').value = '';
        document.getElementById('nome').focus();
        document.querySelectorAll('.filtro-rapido').forEach(btn => {
            btn.classList.remove('active');
        });

        // Mostrar todos os resultados se existirem
        document.querySelectorAll('.resultado-item').forEach(item => {
            item.style.display = 'block';
        });

        atualizarContadorResultados();
    }

    // Mostrar todos
    function mostrarTodos() {
        window.location.href = '/usuarios';
    }

    // Loading
    function mostrarLoading() {
        document.getElementById('loading').style.display = 'block';
        if (document.getElementById('resultadosBusca')) {
            document.getElementById('resultadosBusca').style.display = 'none';
        }
    }

    // Atualizar contador de resultados
    function atualizarContadorResultados() {
        const resultadosVisiveis = document.querySelectorAll('.resultado-item[style*="display: block"], .resultado-item:not([style*="display: none"])');
        const total = resultadosVisiveis.length;

        if (document.getElementById('totalResultados')) {
            document.getElementById('totalResultados').textContent = total;
        }

        // Mostrar/ocultar estatísticas
        const estatisticas = document.getElementById('estatisticasBusca');
        if (total > 0 && document.getElementById('nome').value.trim() !== '') {
            estatisticas.style.display = 'block';
            document.getElementById('termoBusca').textContent = ` para "${document.getElementById('nome').value}"`;
        } else {
            estatisticas.style.display = 'none';
        }
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', function() {
        const inputNome = document.getElementById('nome');
        const limparBtn = document.getElementById('limparBusca');

        // Event listeners
        inputNome.addEventListener('input', buscarTempoReal);
        limparBtn.addEventListener('click', limparBusca);

        // Filtros rápidos
        document.querySelectorAll('.filtro-rapido').forEach(btn => {
            btn.addEventListener('click', function() {
                aplicarFiltroRapido(this.dataset.filtro);
            });
        });

        // Sugestões
        document.querySelectorAll('.sugestao-busca').forEach(btn => {
            btn.addEventListener('click', function() {
                aplicarSugestao(this.dataset.nome);
            });
        });

        // Foco no campo de busca
        inputNome.focus();

        // Atualizar contador inicial
        atualizarContadorResultados();
    });
</script>
</body>
</html>